<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>AI Rhythm Neon Dash</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #overlay {
            position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: #00f2ff; z-index: 20; text-align: center;
        }
        button {
            padding: 15px 30px; font-size: 20px; background: #ff007f; border: none;
            color: white; cursor: pointer; border-radius: 5px; box-shadow: 0 0 15px #ff007f;
        }
        select { padding: 10px; margin-bottom: 20px; background: #111; color: white; border: 1px solid #00f2ff; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>AI NEON RHYTHM</h1>
        <p>Alege genul muzical:</p>
        <select id="genre">
            <option value="techno">Techno / Pop (Rapid)</option>
            <option value="rock">Rock (Energic)</option>
            <option value="hiphop">Hip-Hop (Chill)</option>
        </select>
        <button onclick="startApp()">START GAME</button>
    </div>

    <script>
        let gameStarted = false;
        let player, obstacles, particles, scoreText;
        let bpm = 128;

        // Configurația Jocului
        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            backgroundColor: '#050515',
            physics: { default: 'arcade', arcade: { gravity: { y: 1500 }, debug: false } },
            scene: { preload: preload, create: create, update: update }
        };

        const game = new Phaser.Game(config);

        function preload() {
            // Generare asset-uri neon
            let graphics = this.make.graphics({x: 0, y: 0, add: false});
            
            // Jucător
            graphics.lineStyle(3, 0x00f2ff);
            graphics.strokeRect(0, 0, 40, 40);
            graphics.generateTexture('player', 40, 40);
            
            // Obstacol
            graphics.clear();
            graphics.lineStyle(3, 0xff007f);
            graphics.strokeTriangle(20, 0, 0, 40, 40, 40);
            graphics.generateTexture('spike', 40, 40);

            // Particule
            graphics.clear();
            graphics.fillStyle(0x00f2ff, 1);
            graphics.fillRect(0, 0, 4, 4);
            graphics.generateTexture('particle', 4, 4);
        }

        function create() {
            const self = this;
            
            // Background Grid
            this.grid = this.add.grid(window.innerWidth/2, window.innerHeight/2, window.innerWidth*2, window.innerHeight*2, 50, 50, 0x00f2ff, 0.05, 0x00f2ff, 0.1);

            // Jucător
            player = this.physics.add.sprite(200, 400, 'player');
            player.setCollideWorldBounds(true);

            // Podea invizibilă
            let ground = this.add.rectangle(window.innerWidth/2, window.innerHeight - 50, window.innerWidth, 20, 0x00f2ff, 0.3);
            this.physics.add.existing(ground, true);

            obstacles = this.physics.add.group();
            
            // Particule pentru săritură
            particles = this.add.particles(0, 0, 'particle', {
                speed: 100, scale: { start: 1, end: 0 }, alpha: { start: 1, end: 0 }, lifespan: 500, sprinkling: true, emitting: false
            });

            // Coliziuni
            this.physics.add.collider(player, ground);
            this.physics.add.collider(player, obstacles, () => {
                this.cameras.main.shake(200, 0.05);
                player.setTint(0xff0000);
                setTimeout(() => location.reload(), 500);
            });

            // Input
            this.input.on('pointerdown', jump);
            this.input.keyboard.on('keydown-SPACE', jump);

            scoreText = this.add.text(20, 20, 'Score: 0', { fontSize: '32px', fill: '#00f2ff' });
        }

        function update() {
            if (!gameStarted) return;
            this.grid.x -= 2; // Mișcare fundal
            if (this.grid.x < 0) this.grid.x = window.innerWidth/2;
            
            obstacles.children.iterate(child => {
                if (child && child.x < -50) child.destroy();
            });
        }

        function jump() {
            if (player.body.touching.down) {
                player.setVelocityY(-600);
                particles.emitParticleAt(player.x, player.y + 20, 10);
            }
        }

        // --- LOGICA AUDIO AI (TONE.JS) ---
        function startApp() {
            document.getElementById('overlay').style.display = 'none';
            gameStarted = true;
            
            const genre = document.getElementById('genre').value;
            if(genre === 'rock') bpm = 140;
            else if(genre === 'hiphop') bpm = 90;
            else bpm = 128;

            Tone.start();
            Tone.Transport.bpm.value = bpm;

            // Sintetizator pentru Beat
            const drum = new Tone.MembraneSynth().toDestination();
            const hihat = new Tone.NoiseSynth({ volume: -10 }).toDestination();

            // Bucla principală care generează obstacole pe ritm
            Tone.Transport.scheduleRepeat((time) => {
                drum.triggerAttackRelease("C1", "8n", time);
                
                // Generăm obstacol DOAR pe anumite bătăi pentru a fi jucabil
                Tone.Draw.schedule(() => {
                    spawnObstacle();
                    // Efect vizual de puls pe fundal
                    game.scene.scenes[0].cameras.main.flash(100, 0, 242, 255, 0.05);
                }, time);

            }, "2n"); // "2n" înseamnă la fiecare 2 bătăi (half note)

            Tone.Transport.start();
        }

        function spawnObstacle() {
            if (!gameStarted) return;
            let obs = obstacles.create(window.innerWidth + 50, window.innerHeight - 90, 'spike');
            obs.setVelocityX(-400 - (bpm * 0.5)); // Viteza crește cu BPM-ul
            obs.body.allowGravity = false;
        }
    </script>
</body>
</html>
